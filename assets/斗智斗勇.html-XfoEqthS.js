import{_ as o}from"./plugin-vue_export-helper-x3n3nnut.js";import{o as e,c as i,f as c}from"./app-XffPLay1.js";const l="/assets/image-20231010185012508-p4FzeIgV.png",d="/assets/image-20231010202131460-Suxrp2ta.png",t="/assets/image-20231010202158260-ln1uzlWB.png",p="/assets/image-20231010183101587-lc-GsZ4k.png",g="/assets/image-20231010191142087-AtKKNkZx.png",a="/assets/image-20231010191425158-dVmjtj2I.png",n="data:image/png;base64,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",s={},r=c('<p>一直以来，我都十分推崇把看到的理论知识与实际相结合。</p><p>在今天排查服务器的过程中，顺便扩展的了解了一些东西，现在把他总结成一篇文章记录一下。</p><ol><li><p>每一个进程都有一个文件描述符表(通过<code>lsof -p 进程号</code>)，文件描述表是操作系统内核为每个进程维护的数据结构，用于跟踪和管理进程<code>所打开的文件和其他I/O资源</code>。</p><ol><li><img src="'+l+'" alt="image-20231010185012508" tabindex="0" loading="lazy"><figcaption>image-20231010185012508</figcaption></li></ol></li><li><p>每个进程在<code>/proc/</code>目录下都有一个以该<code>进程ID</code>为名的文件夹，存放了处于该进程的相关信息。可以通过<code>/proc/进程id/fd</code>找到该进程对应所有的文件描述符。在<code>fd</code>目录下中，每个文件描述符对应一个符号链接，每一个符号链接指向该进程打开的文件、套接字、管道。个人觉得在文件系统中他的呈现就是一个符号链接，可以通过该符号链接获取进程打开的文件或<code>I/O</code>资源的相关信息。</p><ol><li><img src="'+d+'" alt="image-20231010202131460" tabindex="0" loading="lazy"><figcaption>image-20231010202131460</figcaption></li><li><img src="'+t+'" alt="image-20231010202158260" tabindex="0" loading="lazy"><figcaption>image-20231010202158260</figcaption></li></ol><blockquote><p>引申一下：<code>/proc/</code> 目录下存放了关于正在运行的进程和系统状态的虚拟文件系统</p><ol><li>包括进程、CPU信息、内存、文件系统、网络、内核等信息</li></ol></blockquote></li><li><p>FD具体有哪些类型？</p><ol><li><figure><img src="'+p+'" alt="image-20231010183101587" tabindex="0" loading="lazy"><figcaption>image-20231010183101587</figcaption></figure></li><li><p>上图是我在服务器上查到的病毒程序，为了彻底把他干掉，同时满足自己的好奇心，我没有直接把干掉。用<code>lsof</code>查看该进程和哪些文件有关，加深对FD的理解。</p><blockquote><p><strong>FD常见的类型如下，我按照在lsof中的输出是否为整数来进行分类：</strong></p><ol><li><p>不为整数</p><ul><li><p><code>cwd</code>：当前进程的工作目录，表示当前进程的工作目录。它是进程执行命令时所在的目录。</p><ul><li>如上图中的<code>/tmp/.X2zz-unix/.rsync/c</code>，知道这个就知道病毒进程的老家在哪了？</li></ul></li><li><p><code>rtd</code>：（Root Directory）表示根目录。它是文件系统的最顶层目录。rtd文件描述符指向根目录。</p><ul><li><code>txt</code>（Text File）表示可执行文件或共享库文件。txt文件描述符指向该可执行文件或共享库文件。 <ul><li>一般情况下都是指<strong>进程对应的可执行程序本身</strong>，如上图中的<code>/tmp/.X2zz-unix/.rsync/c/blitz64</code></li></ul></li></ul></li><li><p><code>mem</code>（Memory-mapped File）表示内存映射文件。内存映射文件是一种将文件内容映射到进程的虚拟内存空间的机制，允许对文件进行像访问内存一样的操作。mem文件描述符指向内存映射文件。</p></li></ul></li><li><p>为整数(从0开始描述)</p><ul><li><code>sock</code>（Socket）：表示套接字文件描述符，用于进程之间的通信。</li><li><code>pipe</code>（Pipe）：表示管道文件描述符，用于进程间的无名管道通信。</li><li><code>event</code>（Event）：表示事件文件描述符，用于异步事件通知。</li><li><code>inotify</code>（Inotify）：表示inotify文件描述符，用于监视文件系统事件。</li><li><code>timer</code>（Timer）：表示定时器文件描述符，用于定时器事件。</li></ul></li></ol><p>**补充：**对FD列中的<code>0r</code>、<code>1r</code>、<code>2u</code>进行说明：</p><ol><li><code>0</code>、<code>1</code>、<code>2</code>三个文件描述符是每个运行着的进程都会自动打开的，具有固定含义： <ol><li><code>0</code>：代表标准输入，通常是键盘输入。</li><li><code>1</code>：代表标准输出，通常是屏幕输出。</li><li><code>2</code>：代表标准错误输出。</li></ol></li><li><code>r</code>、<code>u</code>、<code>w</code>等标识了文件描述符对应文件的打开模式。 <ol><li><code>r</code>：表示文件以<code>r</code>(表示读取)的状态打开的，获取的是读取访问权限，即进程当前正从该文件读取数据。</li><li><code>u</code>：表示文件以<code>u</code>(表示使用)的状态打开的，获取的是读写访问权限。</li><li><code>w</code>：表示文件以<code>w</code>(表示写入)的状态打开的，获取的是写入访问权限，即进程当前正向该文件写入数据。</li></ol></li></ol></blockquote></li></ol></li><li><p>读取<code>FD</code>描述符对应的文件，这里我以病毒进程为例：</p><ol><li><p>通过<code>lsof -p 进程id</code>找到目标进程打开的文件：</p><figure><img src="'+g+'" alt="image-20231010191142087" tabindex="0" loading="lazy"><figcaption>image-20231010191142087</figcaption></figure></li><li><p>通过<code>cat &lt; /proc/3232977/fd/2</code>读取文件内容：</p></li></ol></li></ol><figure><img src="'+a+'" alt="image-20231010191425158" tabindex="0" loading="lazy"><figcaption>image-20231010191425158</figcaption></figure><p>​ 3. 发现该病毒程序在执行一些奇怪代码。</p><p><strong>小插曲：</strong></p><p>为什么病毒中有一个压缩包叫<code>dota3.tar.gz</code>，是这哥们喜欢玩刀塔嘛？</p><figure><img src="'+n+'" alt="image-20231010183219622" tabindex="0" loading="lazy"><figcaption>image-20231010183219622</figcaption></figure>',8),m=[r];function A(u,f){return e(),i("div",null,m)}const v=o(s,[["render",A],["__file","斗智斗勇.html.vue"]]);export{v as default};
