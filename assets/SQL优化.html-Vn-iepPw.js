import{_ as s}from"./plugin-vue_export-helper-x3n3nnut.js";import{o as a,c as n,f as e}from"./app-XffPLay1.js";const p="/assets/image-20230830211428454-YE7-HWMG.png",t="/assets/image-20230830211441780-rUeJBCBV.png",o="/assets/image-20230830213034640-i889Zpgr.png",c="/assets/image-20230830213108145-HQWjjjGs.png",l={},i=e(`<h2 id="分组后查询最新数据的sql优化" tabindex="-1"><a class="header-anchor" href="#分组后查询最新数据的sql优化" aria-hidden="true">#</a> 分组后查询最新数据的SQL优化</h2><h3 id="_1、原来的sql语句-4-082s" tabindex="-1"><a class="header-anchor" href="#_1、原来的sql语句-4-082s" aria-hidden="true">#</a> 1、原来的SQL语句(4.082s)</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> ps<span class="token punctuation">.</span><span class="token operator">*</span> 
<span class="token keyword">FROM</span> pump_water_yield ps
<span class="token keyword">JOIN</span> <span class="token punctuation">(</span> 
    <span class="token keyword">SELECT</span> pump_name<span class="token punctuation">,</span> <span class="token function">MAX</span><span class="token punctuation">(</span> create_date <span class="token punctuation">)</span> <span class="token keyword">AS</span> max_create_date <span class="token keyword">FROM</span> pump_water_yield <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> pump_name 
<span class="token punctuation">)</span> latest <span class="token keyword">ON</span> ps<span class="token punctuation">.</span>pump_name <span class="token operator">=</span> latest<span class="token punctuation">.</span>pump_name <span class="token operator">AND</span> ps<span class="token punctuation">.</span>create_date <span class="token operator">=</span> latest<span class="token punctuation">.</span>max_create_date
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+p+`" alt="image-20230830211428454" tabindex="0" loading="lazy"><figcaption>image-20230830211428454</figcaption></figure><h3 id="_2、先缩小范围-再group-by-2-5s" tabindex="-1"><a class="header-anchor" href="#_2、先缩小范围-再group-by-2-5s" aria-hidden="true">#</a> 2、先缩小范围，再Group By(2.5s)</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> ps<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">FROM</span> pump_water_yield ps
<span class="token keyword">JOIN</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> pump_name<span class="token punctuation">,</span> <span class="token function">MAX</span><span class="token punctuation">(</span>create_date<span class="token punctuation">)</span> <span class="token keyword">AS</span> max_timestamp
    <span class="token keyword">FROM</span> pump_water_yield
    <span class="token keyword">WHERE</span> create_date <span class="token operator">&gt;=</span> DATE_SUB<span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">60</span> <span class="token keyword">MINUTE</span><span class="token punctuation">)</span>
    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> pump_name
<span class="token punctuation">)</span> latest <span class="token keyword">ON</span> ps<span class="token punctuation">.</span>pump_name <span class="token operator">=</span> latest<span class="token punctuation">.</span>pump_name <span class="token operator">AND</span> ps<span class="token punctuation">.</span>create_date <span class="token operator">=</span> latest<span class="token punctuation">.</span>max_timestamp<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+t+'" alt="image-20230830211441780" tabindex="0" loading="lazy"><figcaption>image-20230830211441780</figcaption></figure><h3 id="_3、建立索引后" tabindex="-1"><a class="header-anchor" href="#_3、建立索引后" aria-hidden="true">#</a> 3、建立索引后</h3><p><code>idx_pump_name_create_date</code></p><p>建立索引后:</p><ul><li>SQL1 -&gt; <strong>0.364s</strong><ul><li><img src="'+o+'" alt="image-20230830213034640" tabindex="0" loading="lazy"><figcaption>image-20230830213034640</figcaption></li></ul></li><li>SQL2 -&gt; <strong>0.365s</strong><ul><li><img src="'+c+`" alt="image-20230830213108145" tabindex="0" loading="lazy"><figcaption>image-20230830213108145</figcaption></li></ul></li></ul><h3 id="_4、开窗函数-mysql8-0才开始支持" tabindex="-1"><a class="header-anchor" href="#_4、开窗函数-mysql8-0才开始支持" aria-hidden="true">#</a> 4、开窗函数(MySQL8.0才开始支持)</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
	<span class="token operator">*</span> 
<span class="token keyword">FROM</span>
	<span class="token punctuation">(</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span> RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span> <span class="token punctuation">(</span> <span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> pump_name <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> create_date <span class="token keyword">DESC</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> row_num <span class="token keyword">FROM</span> pump_water_yield <span class="token punctuation">)</span> ranked 
<span class="token keyword">WHERE</span>
	row_num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>为什么数据库用的是MySQL5.7，而不是MySQL8？</p></blockquote><h3 id="_5、拆分为两条sql语句" tabindex="-1"><a class="header-anchor" href="#_5、拆分为两条sql语句" aria-hidden="true">#</a> 5、拆分为两条SQL语句</h3><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> t1<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> t2<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> pumping_station t1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> pump_water_yield a <span class="token keyword">where</span> a<span class="token punctuation">.</span>pump_name <span class="token operator">=</span> <span class="token string">&quot;瑶海东路入二十埠河排口泵站&quot;</span> <span class="token keyword">order</span> <span class="token keyword">by</span> create_date <span class="token keyword">desc</span> <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">)</span> t2 <span class="token keyword">where</span> t2<span class="token punctuation">.</span>pump_name <span class="token operator">=</span> t1<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><hr><h2 id="原本的sql" tabindex="-1"><a class="header-anchor" href="#原本的sql" aria-hidden="true">#</a> 原本的SQL</h2><p>待解决的问题：</p><ol><li>云服务器MySQL版本转为8</li><li>数据去重</li><li>存储i</li></ol><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
	a<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>
	b<span class="token punctuation">.</span><span class="token operator">*</span> 
<span class="token keyword">FROM</span>
	pump_water_yield a
	<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> pumping_station b <span class="token keyword">ON</span> a<span class="token punctuation">.</span>pump_name <span class="token operator">=</span> b<span class="token punctuation">.</span>
	NAME <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> pump_name<span class="token punctuation">,</span> <span class="token function">MAX</span><span class="token punctuation">(</span> create_date <span class="token punctuation">)</span> <span class="token keyword">AS</span> max_create_date <span class="token keyword">FROM</span> pump_water_yield <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> pump_name <span class="token punctuation">)</span> c <span class="token keyword">ON</span> a<span class="token punctuation">.</span>pump_name <span class="token operator">=</span> c<span class="token punctuation">.</span>pump_name 
	<span class="token operator">AND</span> a<span class="token punctuation">.</span>create_date <span class="token operator">=</span> c<span class="token punctuation">.</span>max_create_date 
<span class="token keyword">WHERE</span>
	a<span class="token punctuation">.</span>pump_name <span class="token operator">=</span> <span class="token string">&quot;瑶海东路入二十埠河排口泵站&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,21),r=[i];function d(u,k){return a(),n("div",null,r)}const v=s(l,[["render",d],["__file","SQL优化.html.vue"]]);export{v as default};
